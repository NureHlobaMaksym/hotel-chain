<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title><%= hotel.hotel_name %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
<header>
    <%- include('header'); %>
</header>
<div class="container d-flex align-items-center justify-content-center my-5">
    <div class="card w-75">
        <div class="card-header">
            <h2><%= hotel.hotel_name %></h2>
            <div class="d-flex align-items-center">
                <% for(let i = 0; i < hotel.star_rating; i++) { %>
                    <i class="bi bi-star-fill text-warning"></i>
                <% } %>
            </div>
            <span><%= hotel.full_addr %></span>
            <span> - Відстань до центру міста <%= hotel.distance_to_city_center_km %> км.</span>
            <span>
                <% if (hotel.near_subway) { %>
                    <span> - Поряд з метро</span>
                <% } %>
            </span>
        </div>

        <div class="modal fade" id="roomModal" tabindex="-1" aria-labelledby="roomModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="roomModalLabel"></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body d-flex">
                        <div>
                            <span id="roomDescription"></span> <br>
                            <span>Площа:</span> <span id="roomSize"></span> м²<br>
                            <span>Дозвіл на куріння:</span> <span id="smokingPermission"></span>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрити</button>
                    </div>
                </div>
            </div>
        </div>


        <div class="modal fade" id="photoModal" tabindex="-1" aria-labelledby="photoModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="photoModalLabel"><%= hotel.hotel_name %></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body p-0">
                        <div id="photoCarousel" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner">
                                <% photographs.forEach((photo, index) => { %>
                                    <div class="carousel-item <%= index === 0 ? 'active' : '' %>"
                                         data-bs-slide-to="<%= index %>">
                                        <img src="<%= photo.hotel_photograph_url %>"
                                             alt="<%= photo.hotel_photograph_description %>"
                                             class="d-block w-100">
                                    </div>
                                <% }) %>
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#photoCarousel"
                                    data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#photoCarousel"
                                    data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <span id="photoCounter" class="text-muted"></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="container row justify-content-center col-12 col-md-12 mt-2 row g-3">
            <% if (photographs.length === 1) { %>
                <div class="col-12">
                    <img src="<%= photographs[0].hotel_photograph_url %>"
                         alt="<%= photographs[0].hotel_photograph_description %>"
                         class="shadow-sm w-100" data-index="0"
                         title="<%= photographs[0].hotel_photograph_description%>"
                         data-bs-url="<%= photographs[0].hotel_photograph_url %>"
                         data-bs-description="<%= photographs[0].hotel_photograph_description %>"
                         data-bs-toggle="modal" data-bs-target="#photoModal">
                </div>
            <% } else if (photographs.length === 2) { %>
                <div class="col-6">
                    <img src="<%= photographs[1].hotel_photograph_url %>"
                         alt="<%= photographs[1].hotel_photograph_description %>"
                         class="shadow-sm w-100" data-index="1"
                         title="<%= photographs[1].hotel_photograph_description%>"
                         data-bs-url="<%= photographs[1].hotel_photograph_url %>"
                         data-bs-description="<%= photographs[1].hotel_photograph_description %>"
                         data-bs-toggle="modal" data-bs-target="#photoModal">
                </div>
                <div class="col-6">
                    <img src="<%= photographs[0].hotel_photograph_url %>"
                         alt="<%= photographs[0].hotel_photograph_description %>"
                         class="shadow-sm w-100" data-index="0"
                         title="<%= photographs[0].hotel_photograph_description%>"
                         data-bs-url="<%= photographs[0].hotel_photograph_url %>"
                         data-bs-description="<%= photographs[0].hotel_photograph_description %>"
                         data-bs-toggle="modal" data-bs-target="#photoModal">
                </div>
            <% } else if (photographs.length === 3) { %>
                <div class="col-4">
                    <div class="col">
                        <img src="<%= photographs[1].hotel_photograph_url %>"
                             alt="<%= photographs[1].hotel_photograph_description %>"
                             data-index="1" class="shadow-sm w-100"
                             title="<%= photographs[1].hotel_photograph_description%>"
                             data-bs-url="<%= photographs[1].hotel_photograph_url %>"
                             data-bs-description="<%= photographs[1].hotel_photograph_description %>"
                             data-bs-toggle="modal" data-bs-target="#photoModal">
                    </div>
                    <div class="col">
                        <img src="<%= photographs[2].hotel_photograph_url %>"
                             alt="<%= photographs[2].hotel_photograph_description %>"
                             data-index="2" class="shadow-sm w-100 mt-2"
                             title="<%= photographs[2].hotel_photograph_description%>"
                             data-bs-url="<%= photographs[2].hotel_photograph_url %>"
                             data-bs-description="<%= photographs[2].hotel_photograph_description %>"
                             data-bs-toggle="modal" data-bs-target="#photoModal">
                    </div>
                </div>
                <div class="col-8">
                    <img src="<%= photographs[0].hotel_photograph_url %>"
                         alt="<%= photographs[0].hotel_photograph_description %>"
                         class="shadow-sm w-100" data-index="0"
                         title="<%= photographs[0].hotel_photograph_description%>"
                         data-bs-url="<%= photographs[0].hotel_photograph_url %>"
                         data-bs-description="<%= photographs[0].hotel_photograph_description %>"
                         data-bs-toggle="modal" data-bs-target="#photoModal">
                </div>
            <% } else if (photographs.length >= 4) { %>
                <div class="col-4">
                    <div class="col">
                        <img src="<%= photographs[1].hotel_photograph_url %>"
                             alt="<%= photographs[1].hotel_photograph_description %>"
                             class="shadow-sm w-100" data-index="1"
                             title="<%= photographs[1].hotel_photograph_description%>"
                             data-bs-url="<%= photographs[1].hotel_photograph_url %>"
                             data-bs-description="<%= photographs[1].hotel_photograph_description %>"
                             data-bs-toggle="modal" data-bs-target="#photoModal">
                    </div>
                    <div class="col">
                        <img src="<%= photographs[2].hotel_photograph_url %>"
                             alt="<%= photographs[2].hotel_photograph_description %>"
                             data-index="2" class="shadow-sm w-100 mt-2"
                             title="<%= photographs[2].hotel_photograph_description%>"
                             data-bs-url="<%= photographs[2].hotel_photograph_url %>"
                             data-bs-description="<%= photographs[2].hotel_photograph_description %>"
                             data-bs-toggle="modal" data-bs-target="#photoModal">
                    </div>
                </div>
                <div class="col-8">
                    <img src="<%= photographs[0].hotel_photograph_url %>"
                         alt="<%= photographs[0].hotel_photograph_description %>"
                         data-index="0" class="shadow-sm w-100"
                         title="<%= photographs[0].hotel_photograph_description%>"
                         data-bs-url="<%= photographs[0].hotel_photograph_url %>"
                         data-bs-description="<%= photographs[0].hotel_photograph_description %>"
                         data-bs-toggle="modal" data-bs-target="#photoModal">
                </div>
                <% if (photographs.length > 7) { %>
                    <% for (var i = 3; i < 6; i++) { %>
                        <div class="col-6 col-md-4 col-lg-3">
                            <img src="<%= photographs[i].hotel_photograph_url %>"
                                 alt="<%= photographs[i].hotel_photograph_description %>"
                                 data-index="<%= i %>" class="shadow-sm w-100"
                                 title="<%= photographs[i].hotel_photograph_description%>"
                                 data-bs-url="<%= photographs[i].hotel_photograph_url %>"
                                 data-bs-description="<%= photographs[i].hotel_photograph_description %>"
                                 data-bs-toggle="modal" data-bs-target="#photoModal">
                        </div>
                    <% } %>
                    <div class="col-6 col-md-4 col-lg-3 position-relative">

                        <img src="<%= photographs[6].hotel_photograph_url %>"
                             alt="<%= photographs[6].hotel_photograph_description %>"
                             data-bs-url="<%= photographs[6].hotel_photograph_url %>"
                             data-index="6"
                             title="<%= photographs[6].hotel_photograph_description%>"
                             data-bs-description="<%= photographs[6].hotel_photograph_description %>"
                             class="shadow-sm w-100 h-100" style="position: absolute; left: 0;"
                             data-bs-toggle="modal" data-bs-target="#photoModal">
                        <div class="overlay-text"> + <%= photographs.length - 7 %> фото</div>
                    </div>
                <% } else { %>
                    <% for (var i = 3; i < photographs.length; i++) { %>
                        <div class="col-6 col-md-4 col-lg-3">
                            <img src="<%= photographs[i].hotel_photograph_url %>"
                                 alt="<%= photographs[i].hotel_photograph_description %>"
                                 data-index="<%= i %>" class="shadow-sm w-100"
                                 title="<%= photographs[i].hotel_photograph_description%>"
                                 data-bs-toggle="modal" data-bs-target="#photoModal"
                                 data-bs-url="<%= photographs[i].hotel_photograph_url %>"
                                 data-bs-description="<%= photographs[i].hotel_photograph_description %>">
                        </div>
                    <% } %>
                <% } %>
            <% } %>
        </div>

        <div class="container">
            <div class="mt-4" style="font-size: 1.2em; text-align: justify; text-indent: 30px">
                <%- hotel.hotel_description %>
            </div>
        </div>

        <div class="container my-5">
            <h2 class="mb-4 text-center">Список номерів</h2>
            <div class="table-responsive">
                <table class="table table-bordered align-middle">
                    <thead class="table-primary text-center">
                    <tr>
                        <th>Назва номера</th>
                    </tr>
                    </thead>
                    <tbody>
                    <% rooms.forEach(room => { %>
                        <tr>
                            <td>
                                <a class="room-name" href="#" style="font-size: large"
                                        data-room-id="<%= room.room_id %>"
                                        data-bs-toggle="modal"
                                        data-bs-target="#roomModal">
                                    <%= room.room_name %>
                                </a>
                            </td>
                        </tr>
                    <% }) %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const photoModal = document.getElementById('photoModal');
            const photoCarousel = document.getElementById('photoCarousel');
            const photoCounter = document.getElementById('photoCounter');
            const totalPhotos = <%= photographs.length %>;
            const carousel = new bootstrap.Carousel(photoCarousel);

            photoModal.addEventListener('show.bs.modal', function (event) {
                const button = event.relatedTarget;
                const index = button.getAttribute('data-index');
                carousel.to(index);
                photoCounter.textContent = `Зображення ${parseInt(index) + 1} з ${totalPhotos}`;
            });

            photoCarousel.addEventListener('slid.bs.carousel', function () {
                const activeIndex = photoCarousel.querySelector('.carousel-item.active').getAttribute('data-bs-slide-to');
                photoCounter.textContent = `Зображення ${parseInt(activeIndex) + 1} з ${totalPhotos}`;
            });
        });

        document.addEventListener('DOMContentLoaded', function () {
            const roomModal = document.getElementById('roomModal');

            roomModal.addEventListener('show.bs.modal', function (event) {
                const button = event.relatedTarget;
                const roomId = button.getAttribute('data-room-id');
                const rooms = <%- JSON.stringify(rooms) %>
                const room = rooms.find(r => r.room_id == roomId);
                if (room) {
                    roomModal.querySelector('#roomModalLabel').textContent = room.room_name;
                    roomModal.querySelector('#roomDescription').textContent = room.room_description;
                    roomModal.querySelector('#roomSize').textContent = room.area;
                    roomModal.querySelector('#smokingPermission').textContent = room.smoking_allowed ? 'присутній' : 'неприсутній';
                }
            });
        });
    </script>
</div>
</body>
</html>
